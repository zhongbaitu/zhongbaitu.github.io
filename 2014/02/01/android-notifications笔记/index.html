
 <!DOCTYPE HTML>
<html lang="chinese">
<head>
  <meta charset="UTF-8">
  
    <title>Android——Notifications笔记 | 钟买能个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="钟买能">
    
    <meta name="description" content="NotificationNotification.BuilderNotificationCompat.Builder
一开始给这三个类给搞糊涂了。
官网是这样解释的：Notification：A class that represents how a persistent notification is to be presented to the user using the NotificationManager.The Notification.Builder has been added to make it easier to construct Notifications.* 构建 Notifications 主要用的类，发现好多方法都给移除给 NotificationCompat.Builder 替代了
Notification.Builder：Builder class for Notification objects. Provides a convenient way to set the various fields of a Notification and generate content views using the platform’s notification layout template. If your app supports versions of Android as old as API level 4, you can instead use NotificationCompat.Builder, available in the Android Support library.*Notification.Builder 是为了让开发者更容易构建出 Notifications 而诞生的。
NotificationCompat.BuilderBuilder class for NotificationCompat objects. Allows easier control over all the flags, as well as help constructing the typical notification layouts.*NotificationCompat.Builder，由上面的加粗可以看出，NotificationCompat.Builder 是解决 Notification.Builder 的兼容问题而诞生的。compat：兼容性
把这三个搞清楚之后，我直接用 NotificationCompat.Builder 来构建 Notifications。">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.png">
    
    
    <link rel="apple-touch-icon" href="/img/me.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/me.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="钟买能个人博客" title="钟买能个人博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="钟买能个人博客">钟买能个人博客</a></h1>
				<h2 class="blog-motto">love . to love . to be love .</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/About">About</a></li>
					
						<li><a href="/Works">Works</a></li>
					
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/02/01/android-notifications笔记/" title="Android——Notifications笔记" itemprop="url">Android——Notifications笔记</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://hackeris.me" title="钟买能">钟买能</a>
    </p>
  <p class="article-time">
    <time datetime="2014-02-01T15:23:16.000Z" itemprop="datePublished">Feb 1 2014</time>
    Updated:<time datetime="2014-04-05T06:01:57.000Z" itemprop="dateModified">Apr 5 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
		</div>
		
		<p>Notification<br>Notification.Builder<br>NotificationCompat.Builder</p>
<p>一开始给这三个类给搞糊涂了。</p>
<p>官网是这样解释的：<br>Notification：<br>A class that represents how a persistent notification is to be presented to the user using the NotificationManager.<br>The Notification.Builder has been added to make it easier to construct Notifications.<br>* 构建 Notifications 主要用的类，发现好多方法都给移除给 NotificationCompat.Builder 替代了</p>
<p>Notification.Builder：<br>Builder class for Notification objects. Provides a convenient way to set the various fields of a Notification and generate content views using the platform’s notification layout template. <strong>If your app supports versions of Android as old as API level 4, you can instead use NotificationCompat.Builder, available in the Android Support library.</strong><br>*Notification.Builder 是为了让开发者更容易构建出 Notifications 而诞生的。</p>
<p>NotificationCompat.Builder<br>Builder class for NotificationCompat objects. Allows easier control over all the flags, as well as help constructing the typical notification layouts.<br>*NotificationCompat.Builder，由上面的加粗可以看出，NotificationCompat.Builder 是解决 Notification.Builder 的兼容问题而诞生的。compat：兼容性</p>
<p>把这三个搞清楚之后，我直接用 NotificationCompat.Builder 来构建 Notifications。</p>
<p><a id="more"></a></p>
<p><pre>NotificationCompat.Builder mBuilder =           //Notification 的兼容类</p>
<pre><code>            new NotificationCompat<span class="preprocessor">.Builder</span>(this)

            <span class="preprocessor">.setSmallIcon</span>(R<span class="preprocessor">.drawable</span><span class="preprocessor">.ic</span>_launcher)   // 若没有设置 largeicon，此为左边的大 icon，设置了 largeicon，则为右下角的小 icon，无论怎样，都影响 Notifications area 显示的图标

            <span class="preprocessor">.setContentTitle</span>(<span class="string">"My notification"</span>) // 标题

            <span class="preprocessor">.setContentText</span>(<span class="string">"Hello World!"</span>)         // 正文

            <span class="preprocessor">.setNumber</span>(<span class="number">3</span>)                       // 设置信息条数
</code></pre><p>//              .setContentInfo(“3”)        // 作用同上，设置信息的条数</p>
<pre><code>            .setLargeIcon(smallicon)           <span class="comment">//largeicon，</span>

            .setDefaults(Notification.DEFAULT_SOUND)<span class="comment">// 设置声音，此为默认声音</span>

            .setVibrate(vT) <span class="comment">// 设置震动，此震动数组为：long vT[]={300,100,300,100}; 还可以设置灯光.setLights(argb, onMs, offMs)</span>

            .setOngoing(<span class="keyword">true</span>)      <span class="comment">//true 使 notification 变为 ongoing，用户不能手动清除，类似 QQ,false 或者不设置则为普通的通知</span>

            .setAutoCancel(<span class="keyword">true</span>);             <span class="comment">// 点击之后自动消失 &lt;/pre&gt;</span>
</code></pre><p>一个 Notifications 完成，现在已经可以把它显示出来，但我们继续 coding，添加点击通知后的跳转。</p>
<p>实例化一个 intent</p>
<p><pre>Intent resultIntent = new Intent(this, ResultActivity.class);</pre><br>实例化一个 TaskStackBuilder , 用于添加动作，就像一个 stack 一样，一个一个压进去</p>
<p><pre>TaskStackBuilder stackBuilder = TaskStackBuilder.create(this);</pre><br>添加父 stack，添加下一个 intent</p>
<p><pre>stackBuilder.addParentStack(this);</p>
<p>stackBuilder.addNextIntent(resultIntent);</p>
<p>PendingIntent resultPendingIntent =<br>                stackBuilder.getPendingIntent(<br>                    0,<br>                    PendingIntent.FLAG_UPDATE_CURRENT<br>                );</pre><br>把刚才的 pending 添加进去</p>
<p><pre>mBuilder.setContentIntent(resultPendingIntent);</pre><br>获得 NotificationManager</p>
<p><pre>NotificationManager mNotificationManager =<br>            (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);</pre><br>mBuilder.build() 会返回一个 Notifications 对象，1000 为 Notifications 的 id，可变动。就可以 notify 出来了。</p>
<p><pre>mNotificationManager.notify(1000, mBuilder.build());</pre><br>效果：<a href="http://segmentfault.com/img/bVbQMt/view" title=" 点击查看原图 " target="_blank"><img src="http://segmentfault.com/img/bVbQMt" alt=" 请输入图片描述 "></a></p>
<p>接下来是构建一个进度条 Notifications</p>
<p><pre>        new Thread(<br>            new Runnable() {</p>
<pre><code>            @Override
            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span>() {
                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&amp;lt;<span class="number">100</span>;i++){
                    mBuilder.setProgress(<span class="number">100</span>, i, <span class="keyword">false</span>); <span class="comment">// 最后一个参数设置  determinate 还是  indeterminate ，</span>
                    <span class="comment">//false 的进度条是可以看到增加的，true 是无限循环的，但设置为 true 的时候，前面连个参数可以忽略设置为 0,0 或者任意</span>

                    mNotificationManager.notify(<span class="number">1000</span>, mBuilder.build());

                    <span class="keyword">try</span> {
                        Thread.sleep(<span class="number">50</span>);
                    } <span class="keyword">catch</span> (InterruptedException e) {
                        <span class="comment">// TODO Auto-generated catch block</span>
                        e.printStackTrace();
                    }
                }

                mBuilder.setContentText(<span class="string">"OK"</span>)
                .setDefaults(Notification.DEFAULT_ALL)   <span class="comment">// 设置后不会出现当进度完成之后奔溃，不设置会奔溃，原因不明。求大神指点</span>
                .setProgress(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">false</span>);
                mNotificationManager.notify(<span class="number">1000</span>, mBuilder.build());

            }
        }).start();&lt;/pre&gt;
</code></pre><p>效果：<br><a href="http://segmentfault.com/img/bVbQMu/view" title=" 点击查看原图 " target="_blank"><img src="http://segmentfault.com/img/bVbQMu" alt=" 请输入图片描述 "></a></p>
<p>若 mBuilder.setProgress(0, 0, true);<br>则：<br><a href="http://segmentfault.com/img/bVbQMv/view" title=" 点击查看原图 " target="_blank"><img src="http://segmentfault.com/img/bVbQMv" alt=" 请输入图片描述 "></a></p>
<p>还有好多功能没有写上去。例如 setstyle，震动到用户进行一些动作才停止等等功能，有空再补上。</p>
<p>还有自定义 Notifications 没搞。先搁置，接下来学 service。加油</p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/安卓/">安卓</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/安卓前端开发/">安卓前端开发</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://hackeris.me/2014/02/01/android-notifications笔记/" data-title="Android——Notifications笔记 | 钟买能个人博客" data-tsina="2162115292" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/02/02/android-processesthreadasynctask（未完，待续。）/" title="Android——Processes,Thread,Async Task（未完，待续。）">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Android——Processes,Thread,Async Task（未完，待续。）</span>
</a>
</div>


<div class="next">
<a href="/2014/01/28/android保存当前活动状态/"  title="Android保存当前活动状态">
 <strong>NEXT:</strong><br/> 
 <span>Android保存当前活动状态
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/git版本控制/" title="git版本控制">git版本控制<sup>3</sup></a></li>
		
			<li><a href="/categories/安卓前端开发/" title="安卓前端开发">安卓前端开发<sup>2</sup></a></li>
		
			<li><a href="/categories/安卓开发杂锦/" title="安卓开发杂锦">安卓开发杂锦<sup>2</sup></a></li>
		
			<li><a href="/categories/生活点滴/" title="生活点滴">生活点滴<sup>4</sup></a></li>
		
			<li><a href="/categories/电脑常识杂锦/" title="电脑常识杂锦">电脑常识杂锦<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Git权威指南/" title="Git权威指南">Git权威指南<sup>2</sup></a></li>
		
			<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
		
			<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
		
			<li><a href="/tags/兼职/" title="兼职">兼职<sup>2</sup></a></li>
		
			<li><a href="/tags/大学/" title="大学">大学<sup>1</sup></a></li>
		
			<li><a href="/tags/安卓/" title="安卓">安卓<sup>4</sup></a></li>
		
			<li><a href="/tags/感悟/" title="感悟">感悟<sup>3</sup></a></li>
		
			<li><a href="/tags/生活/" title="生活">生活<sup>4</sup></a></li>
		
			<li><a href="/tags/翻墙/" title="翻墙">翻墙<sup>1</sup></a></li>
		
			<li><a href="/tags/青春/" title="青春">青春<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hi ^_^  I am ZhongMaiNeng . I love to share anything here. <br/>
			for my collage . for coding . for traveling . for all my life.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2162115292" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/zhongbaitu" target="_blank" title="github"></a>
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://hackeris.me" target="_blank" title="钟买能">钟买能</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



  </body>
</html>
